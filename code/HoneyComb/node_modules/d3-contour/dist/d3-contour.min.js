// https://d3js.org/d3-contour/ Version 1.3.0. Copyright 2018 Mike Bostock.
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],r):r(t.d3=t.d3||{},t.d3)}(this,function(t,p){"use strict";var M=Array.prototype.slice,f=function(t,r){return t-r},E=function(t){return function(){return t}},u=function(t,r){for(var n,e=-1,i=r.length;++e<i;)if(n=a(t,r[e]))return n;return 0};function a(t,r){for(var n,e,i,a,o,h,f,u,c,d,l=r[0],s=r[1],g=-1,v=0,w=t.length,y=w-1;v<w;y=v++){var p=t[v],M=p[0],E=p[1],A=t[y],m=A[0],z=A[1];if(d=void 0,a=f=p,h=c=r,((o=u=A)[0]-a[0])*(h[1]-a[1])==(h[0]-a[0])*(o[1]-a[1])&&(n=f[d=+(f[0]===u[0])],e=c[d],i=u[d],n<=e&&e<=i||i<=e&&e<=n))return 0;s<E!=s<z&&l<(m-M)*(s-E)/(z-E)+M&&(g=-g)}return g}var n=function(){},v=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],A=function(){var l=1,s=1,a=p.thresholdSturges,o=r;function e(r){var t=a(r);if(Array.isArray(t))t=t.slice().sort(f);else{var n=p.extent(r),e=n[0],i=n[1];t=p.tickStep(e,i,t),t=p.range(Math.floor(e/t)*t,Math.floor(i/t)*t,t)}return t.map(function(t){return h(r,t)})}function h(r,n){var i=[],e=[];return function(t,r,h){var f,u,n,e,i,a,c=new Array,d=new Array;f=u=-1,e=t[0]>=r,v[e<<1].forEach(o);for(;++f<l-1;)n=e,e=t[f+1]>=r,v[n|e<<1].forEach(o);v[e<<0].forEach(o);for(;++u<s-1;){for(f=-1,e=t[u*l+l]>=r,i=t[u*l]>=r,v[e<<1|i<<2].forEach(o);++f<l-1;)n=e,e=t[u*l+l+f+1]>=r,a=i,i=t[u*l+f+1]>=r,v[n|e<<1|i<<2|a<<3].forEach(o);v[e|i<<3].forEach(o)}f=-1,i=t[u*l]>=r,v[i<<2].forEach(o);for(;++f<l-1;)a=i,i=t[u*l+f+1]>=r,v[i<<2|a<<3].forEach(o);function o(t){var r,n,e=[t[0][0]+f,t[0][1]+u],i=[t[1][0]+f,t[1][1]+u],a=g(e),o=g(i);(r=d[a])?(n=c[o])?(delete d[r.end],delete c[n.start],r===n?(r.ring.push(i),h(r.ring)):c[r.start]=d[n.end]={start:r.start,end:n.end,ring:r.ring.concat(n.ring)}):(delete d[r.end],r.ring.push(i),d[r.end=o]=r):(r=c[o])?(n=d[a])?(delete c[r.start],delete d[n.end],r===n?(r.ring.push(i),h(r.ring)):c[n.start]=d[r.end]={start:n.start,end:r.end,ring:n.ring.concat(r.ring)}):(delete c[r.start],r.ring.unshift(e),c[r.start=a]=r):c[a]=d[o]={start:a,end:o,ring:[e,i]}}v[i<<3].forEach(o)}(r,n,function(t){o(t,r,n),0<function(t){for(var r=0,n=t.length,e=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++r<n;)e+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return e}(t)?i.push([t]):e.push(t)}),e.forEach(function(t){for(var r,n=0,e=i.length;n<e;++n)if(-1!==u((r=i[n])[0],t))return void r.push(t)}),{type:"MultiPolygon",value:n,coordinates:i}}function g(t){return 2*t[0]+t[1]*(l+1)*4}function r(t,h,f){t.forEach(function(t){var r,n=t[0],e=t[1],i=0|n,a=0|e,o=h[a*l+i];0<n&&n<l&&i===n&&(r=h[a*l+i-1],t[0]=n+(f-r)/(o-r)-.5),0<e&&e<s&&a===e&&(r=h[(a-1)*l+i],t[1]=e+(f-r)/(o-r)-.5)})}return e.contour=h,e.size=function(t){if(!arguments.length)return[l,s];var r=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!(0<r&&0<n))throw new Error("invalid size");return l=r,s=n,e},e.thresholds=function(t){return arguments.length?(a="function"==typeof t?t:Array.isArray(t)?E(M.call(t)):E(t),e):a},e.smooth=function(t){return arguments.length?(o=t?r:n,e):o===r},e};function m(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<i;++o)for(var h=0,f=0;h<e+n;++h)h<e&&(f+=t.data[h+o*e]),n<=h&&(a<=h&&(f-=t.data[h-a+o*e]),r.data[h-n+o*e]=f/Math.min(h+1,e-1+a-h,a))}function z(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<e;++o)for(var h=0,f=0;h<i+n;++h)h<i&&(f+=t.data[o+h*e]),n<=h&&(a<=h&&(f-=t.data[o+(h-a)*e]),r.data[o+(h-n)*e]=f/Math.min(h+1,i-1+a-h,a))}function x(t){return t[0]}function b(t){return t[1]}function S(){return 1}t.contours=A,t.contourDensity=function(){var h=x,f=b,u=S,e=960,i=500,a=20,c=2,d=3*a,l=e+2*d>>c,s=i+2*d>>c,g=E(20);function r(t){var o=new Float32Array(l*s),r=new Float32Array(l*s);t.forEach(function(t,r,n){var e=+h(t,r,n)+d>>c,i=+f(t,r,n)+d>>c,a=+u(t,r,n);0<=e&&e<l&&0<=i&&i<s&&(o[e+i*l]+=a)}),m({width:l,height:s,data:o},{width:l,height:s,data:r},a>>c),z({width:l,height:s,data:r},{width:l,height:s,data:o},a>>c),m({width:l,height:s,data:o},{width:l,height:s,data:r},a>>c),z({width:l,height:s,data:r},{width:l,height:s,data:o},a>>c),m({width:l,height:s,data:o},{width:l,height:s,data:r},a>>c),z({width:l,height:s,data:r},{width:l,height:s,data:o},a>>c);var n=g(o);if(!Array.isArray(n)){var e=p.max(o);n=p.tickStep(0,e,n),(n=p.range(0,Math.floor(e/n)*n,n)).shift()}return A().thresholds(n).size([l,s])(o).map(v)}function v(t){return t.value*=Math.pow(2,-2*c),t.coordinates.forEach(n),t}function n(t){t.forEach(o)}function o(t){t.forEach(w)}function w(t){t[0]=t[0]*Math.pow(2,c)-d,t[1]=t[1]*Math.pow(2,c)-d}function y(){return l=e+2*(d=3*a)>>c,s=i+2*d>>c,r}return r.x=function(t){return arguments.length?(h="function"==typeof t?t:E(+t),r):h},r.y=function(t){return arguments.length?(f="function"==typeof t?t:E(+t),r):f},r.weight=function(t){return arguments.length?(u="function"==typeof t?t:E(+t),r):u},r.size=function(t){if(!arguments.length)return[e,i];var r=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!(0<=r||0<=r))throw new Error("invalid size");return e=r,i=n,y()},r.cellSize=function(t){if(!arguments.length)return 1<<c;if(!(1<=(t=+t)))throw new Error("invalid cell size");return c=Math.floor(Math.log(t)/Math.LN2),y()},r.thresholds=function(t){return arguments.length?(g="function"==typeof t?t:Array.isArray(t)?E(M.call(t)):E(t),r):g},r.bandwidth=function(t){if(!arguments.length)return Math.sqrt(a*(a+1));if(!(0<=(t=+t)))throw new Error("invalid bandwidth");return a=Math.round((Math.sqrt(4*t*t+1)-1)/2),y()},r},Object.defineProperty(t,"__esModule",{value:!0})});